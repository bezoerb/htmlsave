/*! htmlsave - v0.0.7 - 2013-11-25
* Copyright (c) 2013 Ben ZÃ¶rb; Licensed MIT */
!function(a,b){"use strict";"undefined"!=typeof module?module.exports=b():"function"==typeof define&&"object"==typeof define.amd?define([],b):(this||window)[a]=b()}("htmlsave",function(){"use strict";var a={},b={breakword:!0,ellipsis:"..."};return a.truncate=function(a,c,d){var e,f,g=a.length,h=0,i=0,j="",k=0,l="",m=[],n=a.replace(/<[^>]*>/gm,"");if("object"!=typeof d)d=b;else for(var o in b)"undefined"==typeof d[o]&&(d[o]=b[o]);for(0>c&&(c=n.length+c),"string"==typeof d.ellipsis&&(k=d.ellipsis.length,k>c&&(d.ellipsis=d.ellipsis.substr(0,c),k=d.ellipsis.length)),e=0;g>e;e++)if(0!==e&&" "!==a[e]||l.length||d.breakword||(e>0&&(n=a.substr(e+1).replace(/<[^>]*>/gm,"")),h=n.indexOf(" "),0>h&&(h=n.length)),"<"===a[e]||l.length?(l+=a[e],">"===a[e]&&/<\//.test(l)?(j+=l,l="",m.pop()):">"===a[e]&&/\/>/.test(l)?(j+=l,l=""):">"===a[e]&&(j+=l,m.push(l),l="")):(i++,j+=a[e]),""===l&&(i>=c-k||" "===a[e]&&i+h>=c-k)||e===g-1){if(" "===a[e]&&(j=j.substr(0,j.length-1)),i>c-k){var p=i-(c-k);j=j.substr(p)}for(0===m.length&&d.ellipsis&&(j+=d.ellipsis),f=m.length-1;f>=0;f--){var q=m[f],r=q.match(/<\s*(\w+)\s*/)[1],s="</"+r+">";0===f&&d.ellipsis&&(j+=d.ellipsis),j+=s}break}return j},a.slice=function(a,c,d){var e,f,g=[],h=a.length,i=0,j="",k="",l=[],m=0,n=a.replace(/<[^>]*>/gm,"");if("object"!=typeof d)d=b;else for(var o in b)"undefined"==typeof d[o]&&(d[o]=b[o]);for(e=0;h>e;e++){0!==e&&" "!==a[e]||k.length||d.breakword||(e>0&&(n=a.substr(e+1).replace(/<[^>]*>/gm,"")),m=n.indexOf(" "),0>m&&(m=n.length)),"<"===a[e]||k.length?(k+=a[e],">"===a[e]&&/<\//.test(k)?(j+=k,k="",l.pop()):">"===a[e]&&/\/>/.test(k)?(j+=k,k=""):">"===a[e]&&(j+=k,l.push(k),k="")):(i++,j+=a[e]);var p=""===k&&(e<a.length-2&&"</"!==a.substr(e+1,2)||e>a.length-1),q=i+m>=c&&(d.breakword||" "===a[e]);if(q&&p||e===h-1){var r="";for(f=l.length-1;f>=0;f--){var s=l[f],t=s.match(/<\s*(\w+)\s*/)[1],u="</"+t+">";j+=u,r=s+r}g.push(j),j=r,i=0}}return g},a});