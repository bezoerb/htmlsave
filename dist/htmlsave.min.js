!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).htmlsave={})}(this,function(t){"use strict";const e=["area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"],n=["address","article","aside","audio","blockquote","canvas","dd","div","dl","fieldset","figcaption","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","hr","noscript","ol","output","p","pre","section","table","tfoot","ul","video"].concat(e);function s(t){return-1!==n.indexOf(t)}function r(t){return t&&"object"==typeof t&&"number"==typeof t.length&&"[object Array]"===Object.prototype.toString.call(t)||!1}function o(t,...e){let n;const s=Object(t);for(let t=0;e.length>t;t++){n=Object(e[t]);for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&(s[t]=n[t])}return s}function i(t,e=0){let s=t.substr(e);if(/^[^<]*>/.test(s)){const n=t.substr(0,e).lastIndexOf("<");s=0>n?s.replace(/^[^<]*>/,""):t.substr(n)}const r=a(s),o=r.replace(/^[^\s]*/,""),i=[r.length-o.length],l=RegExp("</((?:"+n.join(")|(?:")+"))[^>]*>"),c=s.match(l);if(c){const t=s.substr(0,s.indexOf(c[0]));i.push(a(t).length)}const u=RegExp("<((?:"+n.join(")|(?:")+"))[^>]*/>"),h=s.match(u);if(h){const t=s.substr(0,s.indexOf(h[0]));i.push(a(t).length)}return Math.min.apply(null,i)}function l(t,e=0){const n=i(t,e);if(n)return n;const s=t.substr(e);if(/^\s/.test(s)){return i(t,e+1)||1}return i(s.replace(/^<?[^>]*>/,""),0)}function c(t){const n=t.match(/<(\w+)/);return n&&-1!==e.indexOf(n[1])}function a(t,e){const n=(((e||"")+"").toLowerCase().match(/<[a-z][a-z0-9]*>/g)||[]).join("");return t.replace(/<!--[\s\S]*?-->/gi,"").replace(/<\?(?:php)?[\s\S]*?\?>/gi,"").replace(/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi,(t,e)=>n.indexOf("<"+e.toLowerCase()+">")>-1?t:"")}const u={breakword:!0};const h={breakword:!0,ellipsis:"..."};t.utils={assign:o,canSplit:function(t,e){if(0>=e||e>=t.length)return!1;const n=t.substr(0,e),r=t.substr(e);if(" "===t[e]||" "===t[e-1])return!0;const o=">"===t[e-1]&&(n.match(/<\/(\w+)\s*>$/m)||n.match(/<(\w+)[^\>]*\/>$/m)),i="<"===r[0]&&(r.match(/^<(\w+)[^\>]*>/m)||r.match(/^<(\w+)[^\>]*\/>/m));return o&&s(o[1])||i&&s(i[1])},isArray:r,isVoidElement:c,nextWhitespacePos:l,stripTags:a,whitespacePos:i},t.slice=function(t,e,n){const s=[],a=t.length;let h=0,f="",p="";const g=[],b=[];let d=0,m=t.replace(/<[^>]*>/gm,"");const w=function(t){if(r(t)){const e=t[t.length-1];return n=>n&&t.shift()||t[0]||e}return()=>t}(e),x=o({},u,n||{});for(let e=0;a>e;e++){0!==e&&" "!==t[e]||p.length||x.breakword||(e>0&&(m=t.substr(e+1).replace(/<[^>]*>/gm,"")),0>(d=m.indexOf(" "))&&(d=m.length)),"<"===t[e]||p.length?(p+=t[e],">"===t[e]&&/<\//.test(p)?(f+=p,p="",g.pop(),b.shift()):">"===t[e]&&c(p)?(f+=p,p=""):">"===t[e]&&(f+=p,g.push(p),b.unshift(p.match(/<\s*(\w+)\s*/)[1]),p="")):(h++,f+=t[e]);const n=!p;let r=x.breakword&&h>=w()&&n;if(!x.breakword&&n){const n=0===i(t,e),s=h+l(t,e);r=n&&s>w()}if(r&&b[0]){const n=RegExp("^</("+b[0]+")\\s*>");r&=!t.substr(e+1).match(n)}if(r||e===t.length-1&&h){let t="";w(!0);for(let e=g.length-1;e>=0;e--){const n=g[e];f+="</"+n.match(/<\s*(\w+)\s*/)[1]+">",t=n+t}s.push(f),f=t,h=0}}return s},t.truncate=function(t,e,n){const s=t.length;let r=0,u="",f=0,p="";const g=[],b=t.replace(/<[^>]*>/gm,""),d=a(t).length;let m,w;const x=o({},h,n||{});if(e>=d)return t;if(0===e)return"";if(0>e&&(e=b.length+e),"string"==typeof x.ellipsis&&(f=x.ellipsis.length)>e&&(x.ellipsis=x.ellipsis.substr(0,e),f=x.ellipsis.length),f>=e)throw Error("htmlsave.truncate: Maxlength is less or equal ellipsis length");for(m=0;s>m;m++){"<"===t[m]||p.length?(p+=t[m],">"===t[m]&&/<\//.test(p)?(u+=p,p="",g.pop()):">"===t[m]&&c(p)?(u+=p,p=""):">"===t[m]&&(u+=p,g.push(p),p="")):(r++,u+=t[m]);let n=x.breakword&&r===e-f;if(!x.breakword){let s=0===i(t,m),o=r+l(t,m)-1;d>o&&(o+=f),1===r&&o>e&&(s=!0,r--,u=u.substr(0,u.length-1)),n=s&&o>e}if(n||m===s-1){for(" "===t[m]&&(u=u.substr(0,u.length-1),r--),0===g.length&&x.ellipsis&&t.length>u.length&&(u+=x.ellipsis),w=g.length-1;w>=0;w--){const t=g[w].match(/<\s*(\w+)\s*/)[1];w===g.length-1&&x.ellipsis&&(u+=x.ellipsis),u+="</"+t+">"}break}}return u},Object.defineProperty(t,"__esModule",{value:!0})});
