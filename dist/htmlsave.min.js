(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.htmlsave=f()}})(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){(function(global,factory){if(typeof define==="function"&&define.amd){define(["exports"],factory)}else if(typeof exports!=="undefined"){factory(exports)}else{var mod={exports:{}};factory(mod.exports);global.htmlsave=mod.exports}})(this,function(exports){"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol?"symbol":typeof obj};var blockLevelElements=["address","article","aside","audio","blockquote","canvas","dd","div","dl","fieldset","figcaption","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","hr","noscript","ol","output","p","pre","section","table","tfoot","ul","video"];var voidElements=["area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"];function isBlock(val){return blockLevelElements.indexOf(val)!==-1}function isVoid(val){return voidElements.indexOf(val)!==-1}function isArray(value){return value&&(typeof value==="undefined"?"undefined":_typeof(value))==="object"&&typeof value.length==="number"&&Object.prototype.toString.call(value)==="[object Array]"||false}function assign(target,source){var from;var to=Object(target);var symbols;for(var s=1;s<arguments.length;s++){from=Object(arguments[s]);for(var key in from){if(Object.prototype.hasOwnProperty.call(from,key)){to[key]=from[key]}}if(Object.getOwnPropertySymbols){symbols=Object.getOwnPropertySymbols(from);for(var i=0;i<symbols.length;i++){if(Object.prototype.propertyIsEnumerable.call(from,symbols[i])){to[symbols[i]]=from[symbols[i]]}}}}return to}function canSplit(string,i){if(i<=0||i>=string.length){return false}if(string[i]===" "){return true}var strBefore=string.substr(0,i);var strAfter=string.substr(i);var tagBefore=string[i-1]===">"&&(strBefore.match(/<\/(\w+)\s*>$/m)||strBefore.match(/<(\w+)[^\>]*\/>$/m));var tagAfter=strAfter[0]==="<"&&(strAfter.match(/^<(\w+)[^\>]*>/m)||strAfter.match(/^<(\w+)[^\>]*\/>/m));return tagBefore&&isBlock(tagBefore[1])||tagAfter&&isBlock(tagAfter[1])}function whitespacePos(string,offset){var str=string.substr(offset);var reg=new RegExp("</?((?:"+blockLevelElements.join(")|(?:")+"))");var tagMatch=str.match(reg);if(/^[^<]*>/.test(str)){var match=string.substr(string.substr(0,offset).lastIndexOf("<")).match(/^<\/(\w+)/);if(match&&blockLevelElements.indexOf(match[1])!==-1){return 0}str=str.substr(str.indexOf(">")+1)}var p1=stripTags(str).indexOf(" ");var p2=tagMatch?stripTags(str.substr(0,str.indexOf(tagMatch[0]))).length:p1+1;var result=Math.min(p1,p2);return result>=0?result:str.length}function isVoidElement(tag){var name=tag.match(/<(\w+)/);return name&&isVoid(name[1])}function stripTags(input,allowed){var validTags=(String(allowed||"").toLowerCase().match(/<[a-z][a-z0-9]*>/g)||[]).join("");var tags=/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi;var comments=/<!--[\s\S]*?-->/gi;var php=/<\?(?:php)?[\s\S]*?\?>/gi;return input.replace(comments,"").replace(php,"").replace(tags,function($0,$1){return validTags.indexOf("<"+$1.toLowerCase()+">")>-1?$0:""})}var defaults={breakword:true,ellipsis:"..."};function getMax(val){if(isArray(val)){var _ret=function(){var last=val[val.length-1];return{v:function v(){return val.shift()||last}}}();if((typeof _ret==="undefined"?"undefined":_typeof(_ret))==="object")return _ret.v}return function(){return val}}function slice(string,maxLength,params){var results=[];var length=string.length;var tmpLength=0;var tmp="";var tmpTag="";var openTags=[];var ws=0;var restString=string.replace(/<[^>]*>/gm,"");var i;var j;var max=getMax(maxLength);var options=assign({},defaults,params||{});for(i=0;i<length;i++){if((i===0||string[i]===" ")&&!tmpTag.length&&!options.breakword){if(i>0){restString=string.substr(i+1).replace(/<[^>]*>/gm,"")}ws=restString.indexOf(" ");if(ws<0){ws=restString.length}}if(string[i]==="<"||tmpTag.length){tmpTag+=string[i];if(string[i]===">"&&/<\//.test(tmpTag)){tmp+=tmpTag;tmpTag="";openTags.pop()}else if(string[i]===">"&&isVoidElement(tmpTag)){tmp+=tmpTag;tmpTag=""}else if(string[i]===">"){tmp+=tmpTag;openTags.push(tmpTag);tmpTag=""}}else{tmpLength++;tmp+=string[i]}var notag=tmpTag===""&&(i<string.length-2&&string.substr(i+1,2)!=="</"||i>string.length-1);var lengthcheck=tmpLength+ws>=max()&&(options.breakword||canSplit(string,i));if(lengthcheck&&notag||i===length-1){var tmpnew="";for(j=openTags.length-1;j>=0;j--){var tag=openTags[j];var type=tag.match(/<\s*(\w+)\s*/)[1];var close="</"+type+">";tmp+=close;tmpnew=tag+tmpnew}results.push(tmp);tmp=tmpnew;tmpLength=0}}return results}var defaults$1={breakword:false,ellipsis:"..."};function truncate(string,maxLength,options){var length=string.length;var tmpLength=0;var tmp="";var elength=0;var tmpTag="";var openTags=[];var restString=string.replace(/<[^>]*>/gm,"");var i;var j;if(typeof options==="undefined"){options=defaults$1}else{for(var key in defaults$1){if(typeof options[key]==="undefined"){options[key]=defaults$1[key]}}}if(maxLength===0){return""}if(maxLength<0){maxLength=restString.length+maxLength}if(typeof options.ellipsis==="string"){elength=options.ellipsis.length;if(elength>maxLength){options.ellipsis=options.ellipsis.substr(0,maxLength);elength=options.ellipsis.length}}if(elength>=maxLength){throw new Error("htmlsave.truncate: Maxlength is less or equal ellipsis length")}for(i=0;i<length;i++){if(string[i]==="<"||tmpTag.length){tmpTag+=string[i];if(string[i]===">"&&/<\//.test(tmpTag)){tmp+=tmpTag;tmpTag="";openTags.pop()}else if(string[i]===">"&&isVoidElement(tmpTag)){tmp+=tmpTag;tmpTag=""}else if(string[i]===">"){tmp+=tmpTag;openTags.push(tmpTag);tmpTag=""}}else{tmpLength++;tmp+=string[i]}var notag=tmpTag===""&&(i<string.length-2&&string.substr(i+1,2)!=="</"||i>string.length-1);var ws=options.breakword?0:notag&&whitespacePos(string,i+1);var lengthcheck=tmpLength+ws+elength>maxLength&&(options.breakword||canSplit(string,i));if(lengthcheck&&notag||i===length-1){if(string[i]===" "){tmp=tmp.substr(0,tmp.length-1);tmpLength--}if(tmpLength>maxLength-elength){var diff=tmp.length+(maxLength-(tmpLength+elength));if(/^<?[^<]*>/.test(tmp.substr(diff))){tmp=tmp.substr(0,diff).substr(0,tmp.lastIndexOf("<"));openTags.pop()}else{tmp=tmp.substr(0,diff)}}if(openTags.length===0&&options.ellipsis&&tmp.length<string.length){tmp+=options.ellipsis}for(j=openTags.length-1;j>=0;j--){var tag=openTags[j];var type=tag.match(/<\s*(\w+)\s*/)[1];var close="</"+type+">";if(j===openTags.length-1&&options.ellipsis){tmp+=options.ellipsis}tmp+=close}break}}return tmp}exports.slice=slice;exports.truncate=truncate})},{}]},{},[1])(1)});