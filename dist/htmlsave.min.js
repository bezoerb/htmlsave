/*! htmlsave - v0.0.4 - 2013-11-24
* Copyright (c) 2013 Ben ZÃ¶rb; Licensed MIT */
!function(a,b){"use strict";"undefined"!=typeof module?module.exports=b():"function"==typeof define&&"object"==typeof define.amd?define([],b):(this||window)[a]=b()}("htmlsave",function(){"use strict";var a={},b={breakword:!0,ellipsis:"..."};return a.truncate=function(a,c,d){var e,f,g=a.length,h=0,i=0,j="",k=0,l="",m=[];if("object"!=typeof d)d=b;else for(var n in b)"undefined"==typeof d[n]&&(d[n]=b[n]);for("string"==typeof d.ellipsis&&(k=d.ellipsis.length),e=0;g>e;e++)if(" "!==a[e]||l.length||d.breakword||(h=a.substr(e).replace(/<[^>]*>/gm,"").indexOf(" ")),"<"===a[e]||l.length?(l+=a[e],">"===a[e]&&/<\//.test(l)?(j+=l,l="",m.pop()):">"===a[e]&&/\/>/.test(l)?(j+=l,l=""):">"===a[e]&&(j+=l,m.push(l),l="")):(i++,j+=a[e]),""===l&&i+h>=c-k||e===g-1){if(" "===a[e]&&(j=j.substr(0,j.length-1)),i>c-k){var o=i-(c-k);j=j.substr(o)}for(0===m.length&&d.ellipsis&&(j+=d.ellipsis),f=m.length-1;f>=0;f--){var p=m[f],q=p.match(/<\s*(\w+)\s*/)[1],r="</"+q+">";0===f&&d.ellipsis&&(j+=d.ellipsis),j+=r}break}return j},a.split=function(a,c,d){var e,f,g=[],h=a.length,i=0,j="",k="",l=[];if("object"!=typeof d)d=b;else for(var m in b)"undefined"==typeof d[m]&&(d[m]=b[m]);for(e=0;h>e;e++){"<"===a[e]||k.length?(k+=a[e],">"===a[e]&&/<\//.test(k)?(j+=k,k="",l.pop()):">"===a[e]&&/\/>/.test(k)?(j+=k,k=""):">"===a[e]&&(j+=k,l.push(k),k="")):(i++,j+=a[e]);var n=""===k&&(e<a.length-2&&"</"!==a.substr(e+1,2)||e>a.length-1);if(i>=c&&n&&(d.breakword||" "===a[e])||e===h-1){var o="";for(" "===a[e]&&(j=j.substr(0,j.length-1),o=" "),f=l.length-1;f>=0;f--){var p=l[f],q=p.match(/<\s*(\w+)\s*/)[1],r="</"+q+">";j+=r,o=p+o}g.push(j),j=o,i=0}}return g},a});